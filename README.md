# \[CREW] 프로젝트 소개

![bs](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fc8eb68c2-2877-4eeb-95cc-4c77c944c5e3%2Ff24ff368b03ea0d9.jpg?id=6bb14bf5-9e6e-414e-b1a9-f77610826e2d&table=block&spaceId=aa8571ff-db5c-4c63-a227-0bac038f37bc&width=2000&userId=d31e8c48-c9f3-40c3-8452-373f12137b7d&cache=v2)

- 서비스 : [서비스 바로가기](https://crew.ysizuku.com/)
- 시연 영상 : [유튜브 링크](https://youtu.be/A8RVX12fDa4)
- 발표 자료 : [노션 자료](https://www.notion.so/CREW-ea485c74cc3d481ebc17beac59c33e51)

## Project Architecture

![](<https://chambray-mollusk-2c7.notion.site/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F57361b30-3e1c-49d5-a9cd-631aecf12902%2F9028ebe0-25ae-4c7f-8d33-d1849c076544%2FCrew-%25EB%25B0%259C%25ED%2591%259C-%25EC%259E%2590%25EB%25A3%258C-004_(1).jpg?table=block&id=60712dc6-e1d2-4ff4-bd40-6f1ee702cf28&spaceId=57361b30-3e1c-49d5-a9cd-631aecf12902&width=2000&userId=&cache=v2>)

## 📌 Key Feature

### 메인 페이지

<details>
<summary>- 카카오 맵 </summary>

  ![스크린샷(67).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/549536c6-c283-471d-9052-9fc7779de97a/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(67).png>)
  - 원하는 위치에 모임을 생성할 수 있으며, 모임이 있다면 모임의 정보를 얻을 수 있습니다.
</details>
<details>
<summary>- 알림 기능</summary>

  ![스크린샷(68).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/4b509ee8-69f7-4f9e-b4f2-7c735b914af9/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(68).png>)
  - 실시간으로 알림을 얻을 수 있습니다.
</details>
### 상세 페이지

<details>
<summary>- 참여하기</summary>

  ![스크린샷(69).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/63f8bc2f-3a77-40f6-9c81-bad8841b61c7/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(69).png>)
  - 모임 글의 정보를 확인 후에 참여할 수 있습니다.
  - 참여 후에는 모임의 CREW 원을 확인할 수 있습니다.
</details>

<details>
<summary>- 댓글 작성 및 수정</summary>

  ![스크린샷(70).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/ee6e5aaa-eef2-4806-aeed-6afbafbafee5/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(70).png>)
  - CREW 원들의 활동 또는 소통을 할 수 있는 공간입니다.
</details>

<details>
<summary>- 나가기</summary>

  ![스크린샷(71).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/bd8bef5f-88c3-4c03-b6fc-0c4b7a7fbb50/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(71).png>)
  - 개인 사정이나 특정 상황을 위해 모임에서 나갈 수 있는 기능입니다.
</details>

<details>
<summary>- 내보내기</summary>

  ![스크린샷(73).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/60364537-c68b-4089-9121-255d9f11591f/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(73).png>)
  - Captain의 고유한 권한이며 모임의 원활한 진행을 위한 기능입니다.
</details>

<details>
<summary>- 신고하기</summary>

  ![스크린샷(72).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/57d44afa-f91c-4fec-8f5d-23f74560a74a/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(72).png>)
  - 부적절한 모임이나 활동 또는 댓글 작성을 빠르게 인지하기 위한 기능입니다.
</details>

### 문의하기

<details>
<summary>- 문의하기</summary>

  ![스크린샷(74).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/73d5c261-41d5-47fb-93f4-f660d59ddbae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(74).png>)
  - 유저는 채널톡을 이용해서 자유롭게 서비스에 대한 문의를 할 수 있습니다.
</details>

### 마이 페이지

<details>
<summary>- 프로필</summary>

  ![스크린샷(75).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/52d7b5fa-e13e-44b6-97fe-8654da99619e/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(75).png>)
  - 유저 본인의 정보를 확인할 수 있으며, 생성한 모임과 참여한 모임의 정보를 간단하게 알 수 있습니다.
  </details>

<details>
<summary>- 프로필 수정</summary>

  ![스크린샷(76).png](<https://prod-files-secure.s3.us-west-2.amazonaws.com/57361b30-3e1c-49d5-a9cd-631aecf12902/6a6d9404-85fc-4387-85ac-343fd48e930c/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7(76).png>)
  - 본인이 원하는 이미지를 프로필 이미지로 바꿀 수 있으며, 닉네임과 상태메시지를 변경할 수 있습니다.
</details>

---

## 1. 프로젝트의 설명

우리는 사회를 구성하고 관계를 맺길 원합니다.
가까운 이웃과 비슷한 취미를 가지고 있다면 모임을 만들어 동아리 활동 같은 것을 할 수 있다면 얼마나 좋을까요?
바로 옆집에 사는 이웃의 얼굴도 모르고 사는 시대에 가까운 곳에서 같은 취미나 황동을 할 수 있다면 더욱 즐겁지 않을까요?
우리는 이러한 욕구를 채울 수 있는 공간을 만들고 싶었습니다.

같이 밥을 먹어도 좋고 함께 즐거운 게임을 즐기는 것도 괜찮겠지요. 때론 새로운 취미를 함께 배워보는 것도 멋있을 것입니다.

## 2. 팀 멤버

`Back-end (Node.js)`

- 박윤수(Team Leader)

`Front-end (React)`

- 윤진영A, 윤진영B(Project Leader)

`Design`

- 이도림

## 3. 기술스택

- React
- react-modal
- Quill
- styled-component
- Recoil
- axios
- dompurify
- react-router-dom
- socket.io

### 3.1 기술스택 선정 이유

1. React

2. Recoil

   - React의 구조를 학습하며 전역상태 관리를 위한 Redux를 학습하였습니다. Redux는 컴포넌트의 상태 업데이트 로직을 별도의 파일로 관리할 수 있어 효율적으로 관리할 수 있습니다.
   - 상태를 업데이트하기 위한 로직이 액션 크리이터로 관리되기 때문에 규모가 클수록 체계적으로 관리하기 용이하다는 장점이 있습니다.
   - 그러나 이를 사용하기 위해 높은 러닝 커브와 규모가 작은 프로젝트일때는 Redux를 사용하기 위한 코드량이 늘어나는 단점이 존재합니다.
   - 서비스 기능을 계속해서 다른 방법으로 구현해야만 했던 저희의 경우 미리 액션을 만들고 사용해야하는 Redux는 사용하기 불편하다고 판단했습니다.
   - Recoil은 Atom과 Selector를 사용하여 상태를 관리하고 접근할 수 있으며 사용 방법이 React의 useState 훅과 매우 유사하여 쉽게 학습할 수 있다는 장점이 있었습니다.
   - 미리 액션을 만들어서 사용하지 않아도 되기 때문에 빠르게 코드를 수정하며 코드를 검증해야했던 저희 프로젝트에 알맞다고 판단하여 선정하였습니다.

3. react-router-dom

   - Url에 따른 컴포넌트 분기를 위해 사용했습니다.

4. styled-component

   - CSS 파일을 외부에 고 id,class이름으로 CSS를 적용하는 것은 전역 중첩등의 문제가 발생할 수 있고 이 경우 수정이 까다롭기 때문에 이를 방지하기 위해 사용하였습니다.
   - 또한 컴포넌트 내부에서 컴포넌트 이름처럼 사용할 수 있기 때문에 FE팀 내에서 일정한 작명 규칙을 정해 사용하면 코드를 조금 더 읽기 편하게 할 수 있다고 판단했습니다.

5. Quill

   - 일반적인 사용자들이 사용하는데 불편이 없도록 WYSIWYG 방식을 사용하고자 했습니다.
   - TOAST UI, Lexical 등의 후보를 검토하게 되었습니다.
   - TOAST UI의 경우 국내 사용자에게 익숙한 디자인과 다양한 커스터마이징이 가능하다는 장점이 있었지만 모바일에서 사용이 어려운 단점이 있었습니다.
   - Lexical의 경우 커스터마이징과 수많은 라이브러리 등을 제공했지만 참고할 예제를 찾기 쉽지 않았고 원하는 기능을 모두 구현하기 위해서는 많은 코드 작성이 필요했습니다.
   - Quill은 간편한 세팅과 함께 모바일에서도 문제 없이 사용할 수 있었기 때문에 사용하게 되었습니다.

6. Axios

   - Instance를 이용해서 컴포넌트의 코드를 간소화하고 체계적으로 관리하기 위해 사용하게 되었습니다.

7. dompurify
   - XSS 공격을 방지하기 위해서 사용하였습니다.
   - Text Editor를 이용해서 직접 태그와 스크립트를 입력받진 않지만 예상하지 못한 방법으로 스크립트를 삽입한 게시물이 생성될 경우에 대비하기 위해 빠르게 도입했습니다.

## 4. 주요 기능 구현 과정

긴 기간 동안 작업을 이어나갈 수 있었던 것은 어려운 문제와 마주쳤을 때 동료들과 멘토님들이 다양하게 도움을 주셨기 때문입니다.
동료들과 함께 머리를 맞대고 문제를 해결하는 과정에서 기쁨을 느꼈습니다. 또한 기술매니저님들께서 공유해주신 다양한 참고자료는 저희에게 많은 인사이트를 제공했습니다.

## 4.1 지도의 좌표와 보이는 영역에 따른 글 가져오기

### 4.1.1 언제 서버에 데이터를 요청하는가?

초기에는 지도를 로드할 때 모든 글을 가져오도록 코드를 작성하였습니다. 데이터 양이 적을 때는 문제가 되지 않지만 데이터가 많아지면 문제가 발생할 것이 당연히 예상 가능했습니다. 불필요한 데이터를 받아오지 않도록 사용자가 보고 있는 지도 영역의 데이터만 받아 올 수 있도록 코드를 수정해야했습니다.
지도의 중심좌표가 이동됨에 따라 중심좌표와 모서리 좌표를 근거로 영역을 계산하고 그 안에 있는 데이터만 가져올 수 있도록 개선했습니다.
이 때 사용자가 지도를 드래그하여 이동하는 동안 수십 수백번 서버로 데이터를 요청하는 문제가 발생하는 것을 발견했습니다.

서버에 불필요한 부하를 주지 않기 위해 이동을 마쳤을때 데이터를 요청하는 코드를 고려했으나, 이동하는 동안에도 데이터의 변화를 보여주고 싶었습니다. 다행히 카카오 지도는 타일이 로드 완료되면 발생하는 이벤트리스너가 제공되고 있음을 발견했습니다. 기존의 타일 안에서는 아무리 움직여도 새로운 데이터를 요청하지 않지만 지도를 이동해서 새로운 타일이 필요해져 새 타일을 다운로드 하게 된다면 서버에 데이터를 요청하도록 코드를 개선할 수 있었습니다.

이렇게 함으로써 좁은 면적을 이동했을때는 새 타일이 필요하지 않아 데이터를 새로 요청하지 않게 되었고 많은 영역을 이동해서 새 타일이 필요해지만 그때 새로운 데이터를 요청하는 것으로 데이터 요청 횟수를 유의미하게 줄일 수 있었습니다.

## 4.2 socket.io를 이용한 알림 기능 구현

### 4.2.1 socket 연결을 지나치게 많이 요청하는 이슈

처음 기능을 구현했을 당시 페이지를 이동할때마다 리랜더링이 발생하며 계속해서 소켓에 연결 시도하는 문제가 발견되었습니다. 확인해본 결과, 페이지를 이동할 때마다 알림 컴포넌트가 리랜더링 되고 있음을 확인하였습니다. 이는 라우터 돔을 이용할 때 헤더 영역과 푸터 영역을 페이지 이동할때 계속해서 다시 로드하고 있음을 알게 되었습니다. 이를 개선하기 위해 Layout을 outlet화하여 문제를 해결하도록 시도했습니다.
이로서 연결요청을 지나치게 자주 보내는 문제는 개선되었지만 다른 이슈가 발견되었습니다.

### 4.2.2 로그인 직후에는 소켓에 연결되지 않는 이슈

위 문제를 해결한 뒤 발생한 문제로 로그아웃 직후 소켓이 연결되지 않고 새로고침을 해야만 연결되는 현상을 발견했습니다. 원인을 분석해본 결과 소켓이 실행되는 타이밍은 로그인하기 전에 이미 실행되어 있으며 로그인 하더라도 토큰 값을 가져오기 전에 소켓이 실행되어 토큰 없이 연결 요청을 하는 것으로 확인되었습니다. 로그인 여부에 따라 알림 컴포넌트가 동작하지만 소켓 연결 요청이 컴포넌트가 모두 로드 되기 전에 동작하는 것이 원인이므로 Lazy Loading을 활용해서 실제 알림 기능이 필요해 질때 실행될 수 있도록 개선했습니다.
그 결과 로그인을 완료한 뒤 실제로 소켓 요청이 필요해질 때 토큰 값을 가져오도록 하여 문제를 해결할 수 있었습니다.

## 4.3 사용자 프로필 기능과 마이페이지

### 4.3.1 사용자 프로필 수정

유저 피드백 개선 사항 중 가장 많은 부분이 마이페이지였습니다.
카카오로그인을 통해 받아온 사용자 정보를 이용하고 있었기 때문에 카카오에 설정된 닉네임이 사용되는 것으로 인해 불편함을 느끼는 사용자가 있었습니다.

이에 프로필 수정 기능을 추가하여 프로필 이미지와 닉네임, 그리고 간단한 상태메세지를 작성할 수 있도록 개선했습니니다.
이미지 파일을 업로드하기 위해 로컬에서 선택하면 해당 파일 정보를 받아와 미리보기할 수 있도록 페이지에 표시해 주었습니다.
이로써 프로필 수정시 어떤식으로 보여질 수 있을지 미리 알 수 있고 시각적인 즐거움을 줄 수 있도록 개선했습니다.

최초 서버에서 이미지와 닉네임 상태메세지를 모두 입력 받아야만 수정이 가능한 이슈가 있어 BE팀과 이를 공유하여 이미지만 업로드하면 프로필 사진만 변경이 될 수 있도록 개선했으나, 사진을 업로드 하지 않으면 동일한 문제가 발생하여 사진을 업로드 하지 않으면 null 값을 넘겨주도록 하고 이미지 데이터가 null일 경우 이미지를 교체하지 않고 유지하도록 개선했습니다.

내가 만든 보트의 리스트만 boder로 감싸져 있어 구분이 어려웠습니다.
내가 만든 보트에 백그라운드 컬러를 추가하고 참여 중인 보트 리스트도 시각적으로 구분할 수 있도록 꾸며주어 조금 더 시각적으로 편하게 개선하였습니다.

## 5. 이후의 계획

### 5.1 유저 플로우의 개선

- 현재 로그인이 필요한 기능에 접근을 시도할 경우 Alert을 발생시킨 후 메인 페이지로 이동하도록 동작하고 있습니다. 로그인 페이지로 리다이렉트 혹은 로그인 컴포넌트를 모달로 발생 시키는 것을 적용할 게획입니다.

### 5.2 고용랑 이미지 업로드 문제 개선

현재 사용자가 이미지를 업로드할 때 아무런 제한 없이 업로드 가능하여 지나치게 큰 이미지를 업로드할 경우 성능 문제가 발생할 가능성이 있습니다.
따라서 3가지 방법으로 개선할 계획입니다.

1. 이미지 업로드시 용량 제한을 설정한다.
2. 이미지 업로드 전 클라이언트에서 이미지 압축을 진행한다.
3. 이미지 압축 및 업로드 과정이 진행될 경우 프로그래스 바 또는 스피닝 기어 등을 표시하여 시각적으로 작업 중임을 알리도록 한다.

### 5.3 사용자간 상호작용

다른 사용자를 팔로우하거나 친구 추가 하는 등 상호 작용을 고려하고 있습니다.
우선 다른 사용자의 프로필을 열람해볼 수 있는 기능을 추가해볼 예정입니다.

### 5.4 유저간 소통 기능의 추가

현재 저희 서비스에서는 댓글외에는 사용자간 소통할 기능이 없어 아쉽다는 피드백이 많았습니다.
사용자간 쪽지 혹은 채팅을 할 수 있는 기능을 추가할 계획입니다.
1:1 채팅과 단체 채팅을 이용해서 다양한 커뮤니케이션 방법을 이용할 수 있도록 개선해나갈 수 있을 것으로 기대됩니다.
